(function(e,d){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(b,a,c){e.Backbone=d(e,c,b,a)})}else{if(typeof exports!=="undefined"){var f=require("underscore");d(e,exports,f)}else{e.Backbone=d(e,{},e._,(e.jQuery||e.Zepto||e.ender||e.$))}}}(this,function(ag,aa,O,ac){var Y=ag.Backbone;var aw=[];var W=aw.push;var an=aw.slice;var ah=aw.splice;aa.VERSION="1.1.2";aa.$=ac;aa.noConflict=function(){ag.Backbone=Y;return this};aa.emulateHTTP=false;aa.emulateJSON=false;var Q=aa.Events={on:function(d,a,b){if(!ad(this,"on",d,[a,b])||!a){return this}this._events||(this._events={});var c=this._events[d]||(this._events[d]=[]);c.push({callback:a,context:b,ctx:b||this});return this},once:function(d,a,c){if(!ad(this,"once",d,[a,c])||!a){return this}var e=this;var b=O.once(function(){e.off(d,b);a.apply(this,arguments)});b._callback=a;return this.on(d,b,c)},off:function(k,b,j){var d,c,a,e,f,i,g,h;if(!this._events||!ad(this,"off",k,[b,j])){return this}if(!k&&!b&&!j){this._events=void 0;return this}e=k?[k]:O.keys(this._events);for(f=0,i=e.length;f<i;f++){k=e[f];if(a=this._events[k]){this._events[k]=d=[];if(b||j){for(g=0,h=a.length;g<h;g++){c=a[g];if((b&&b!==c.callback&&b!==c.callback._callback)||(j&&j!==c.context)){d.push(c)}}}if(!d.length){delete this._events[k]}}}return this},trigger:function(b){if(!this._events){return this}var c=an.call(arguments,1);if(!ad(this,"trigger",b,c)){return this}var a=this._events[b];var d=this._events.all;if(a){aB(a,c)}if(d){aB(d,arguments)}return this},stopListening:function(c,e,a){var d=this._listeningTo;if(!d){return this}var f=!e&&!a;if(!a&&typeof e==="object"){a=this}if(c){(d={})[c._listenId]=c}for(var b in d){c=d[b];c.off(e,a,this);if(f||O.isEmpty(c._events)){delete this._listeningTo[b]}}return this}};var ae=/\s+/;var ad=function(a,c,g,d){if(!g){return true}if(typeof g==="object"){for(var e in g){a[c].apply(a,[e,g[e]].concat(d))}return false}if(ae.test(g)){var b=g.split(ae);for(var f=0,h=b.length;f<h;f++){a[c].apply(a,[b[f]].concat(d))}return false}return true};var aB=function(c,e){var b,d=-1,f=c.length,g=e[0],h=e[1],a=e[2];switch(e.length){case 0:while(++d<f){(b=c[d]).callback.call(b.ctx)}return;case 1:while(++d<f){(b=c[d]).callback.call(b.ctx,g)}return;case 2:while(++d<f){(b=c[d]).callback.call(b.ctx,g,h)}return;case 3:while(++d<f){(b=c[d]).callback.call(b.ctx,g,h,a)}return;default:while(++d<f){(b=c[d]).callback.apply(b.ctx,e)}return}};var X={listenTo:"on",listenToOnce:"once"};O.each(X,function(b,a){Q[a]=function(e,g,c){var f=this._listeningTo||(this._listeningTo={});var d=e._listenId||(e._listenId=O.uniqueId("l"));f[d]=e;if(!c&&typeof g==="object"){c=this}e[b](g,c,this);return this}});Q.bind=Q.on;Q.unbind=Q.off;O.extend(aa,Q);var V=aa.Model=function(c,a){var b=c||{};a||(a={});this.cid=O.uniqueId("c");this.attributes={};if(a.collection){this.collection=a.collection}if(a.parse){b=this.parse(b,a)||{}}b=O.defaults({},b,O.result(this,"defaults"));this.set(b,a);this.changed={};this.initialize.apply(this,arguments)};O.extend(V.prototype,Q,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return O.clone(this.attributes)},sync:function(){return aa.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return O.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(e,m,a){var g,d,c,f,h,b,k,i;if(e==null){return this}if(typeof e==="object"){d=e;a=m}else{(d={})[e]=m}a||(a={});if(!this._validate(d,a)){return false}c=a.unset;h=a.silent;f=[];b=this._changing;this._changing=true;if(!b){this._previousAttributes=O.clone(this.attributes);this.changed={}}i=this.attributes,k=this._previousAttributes;if(this.idAttribute in d){this.id=d[this.idAttribute]}for(g in d){m=d[g];if(!O.isEqual(i[g],m)){f.push(g)}if(!O.isEqual(k[g],m)){this.changed[g]=m}else{delete this.changed[g]}c?delete i[g]:i[g]=m}if(!h){if(f.length){this._pending=a}for(var j=0,l=f.length;j<l;j++){this.trigger("change:"+f[j],this,i[f[j]],a)}}if(b){return this}if(!h){while(this._pending){a=this._pending;this._pending=false;this.trigger("change",this,a)}}this._pending=false;this._changing=false;return this},unset:function(b,a){return this.set(b,void 0,O.extend({},a,{unset:true}))},clear:function(b){var c={};for(var a in this.attributes){c[a]=void 0}return this.set(c,O.extend({},b,{unset:true}))},hasChanged:function(a){if(a==null){return !O.isEmpty(this.changed)}return O.has(this.changed,a)},changedAttributes:function(c){if(!c){return this.hasChanged()?O.clone(this.changed):false}var a,b=false;var d=this._changing?this._previousAttributes:this.attributes;for(var e in c){if(O.isEqual(d[e],(a=c[e]))){continue}(b||(b={}))[e]=a}return b},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return O.clone(this._previousAttributes)},fetch:function(b){b=b?O.clone(b):{};if(b.parse===void 0){b.parse=true}var c=this;var a=b.success;b.success=function(d){if(!c.set(c.parse(d,b),b)){return false}if(a){a(c,d,b)}c.trigger("sync",c,d,b)};S(this,b);return this.sync("read",this,b)},save:function(e,h,a){var d,i,b,g=this.attributes;if(e==null||typeof e==="object"){d=e;a=h}else{(d={})[e]=h}a=O.extend({validate:true},a);if(d&&!a.wait){if(!this.set(d,a)){return false}}else{if(!this._validate(d,a)){return false}}if(d&&a.wait){this.attributes=O.extend({},g,d)}if(a.parse===void 0){a.parse=true}var f=this;var c=a.success;a.success=function(j){f.attributes=g;var k=f.parse(j,a);if(a.wait){k=O.extend(d||{},k)}if(O.isObject(k)&&!f.set(k,a)){return false}if(c){c(f,j,a)}f.trigger("sync",f,j,a)};S(this,a);i=this.isNew()?"create":(a.patch?"patch":"update");if(i==="patch"){a.attrs=d}b=this.sync(i,this,a);if(d&&a.wait){this.attributes=g}return b},destroy:function(d){d=d?O.clone(d):{};var e=this;var a=d.success;var c=function(){e.trigger("destroy",e,e.collection,d)};d.success=function(f){if(d.wait||e.isNew()){c()}if(a){a(e,f,d)}if(!e.isNew()){e.trigger("sync",e,f,d)}};if(this.isNew()){d.success();return false}S(this,d);var b=this.sync("delete",this,d);if(!d.wait){c()}return b},url:function(){var a=O.result(this,"urlRoot")||O.result(this.collection,"url")||aj();if(this.isNew()){return a}return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},O.extend(a||{},{validate:true}))},_validate:function(a,b){if(!b.validate||!this.validate){return true}a=O.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;if(!c){return true}this.trigger("invalid",this,c,O.extend(b,{validationError:c}));return false}});var aC=["keys","values","pairs","invert","pick","omit"];O.each(aC,function(a){V.prototype[a]=function(){var b=an.call(arguments);b.unshift(this.attributes);return O[a].apply(O,b)}});var aA=aa.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,O.extend({silent:true},b))}};var am={add:true,remove:true,merge:true};var P={add:true,remove:false};O.extend(aA.prototype,Q,{model:V,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return aa.sync.apply(this,arguments)},add:function(a,b){return this.set(a,O.extend({merge:false},b,P))},remove:function(a,d){var b=!O.isArray(a);a=b?[a]:O.clone(a);d||(d={});var c,g,e,f;for(c=0,g=a.length;c<g;c++){f=a[c]=this.get(a[c]);if(!f){continue}delete this._byId[f.id];delete this._byId[f.cid];e=this.indexOf(f);this.models.splice(e,1);this.length--;if(!d.silent){d.index=e;f.trigger("remove",f,this,d)}this._removeReference(f,d)}return b?a[0]:a},set:function(o,k){k=O.defaults({},k,am);if(k.parse){o=this.parse(o,k)}var h=!O.isArray(o);o=h?(o?[o]:[]):O.clone(o);var s,u,c,j,a,d,p;var f=k.at;var q=this.model;var l=this.comparator&&(f==null)&&k.sort!==false;var r=O.isString(this.comparator)?this.comparator:null;var m=[],v=[],b={};var e=k.add,i=k.merge,n=k.remove;var t=!l&&e&&n?[]:false;for(s=0,u=o.length;s<u;s++){a=o[s]||{};if(a instanceof V){c=j=a}else{c=a[q.prototype.idAttribute||"id"]}if(d=this.get(c)){if(n){b[d.cid]=true}if(i){a=a===j?j.attributes:a;if(k.parse){a=d.parse(a,k)}d.set(a,k);if(l&&!p&&d.hasChanged(r)){p=true}}o[s]=d}else{if(e){j=o[s]=this._prepareModel(a,k);if(!j){continue}m.push(j);this._addReference(j,k)}}j=d||j;if(t&&(j.isNew()||!b[j.id])){t.push(j)}b[j.id]=true}if(n){for(s=0,u=this.length;s<u;++s){if(!b[(j=this.models[s]).cid]){v.push(j)}}if(v.length){this.remove(v,k)}}if(m.length||(t&&t.length)){if(l){p=true}this.length+=m.length;if(f!=null){for(s=0,u=m.length;s<u;s++){this.models.splice(f+s,0,m[s])}}else{if(t){this.models.length=0}var g=t||m;for(s=0,u=g.length;s<u;s++){this.models.push(g[s])}}}if(p){this.sort({silent:true})}if(!k.silent){for(s=0,u=m.length;s<u;s++){(j=m[s]).trigger("add",j,this,k)}if(p||(t&&t.length)){this.trigger("sort",this,k)}}return h?o[0]:o},reset:function(a,c){c||(c={});for(var b=0,d=this.models.length;b<d;b++){this._removeReference(this.models[b],c)}c.previousModels=this.models;this._reset();a=this.add(a,O.extend({silent:true},c));if(!c.silent){this.trigger("reset",this,c)}return a},push:function(a,b){return this.add(a,O.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,O.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return an.apply(this.models,arguments)},get:function(a){if(a==null){return void 0}return this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(b,a){if(O.isEmpty(b)){return a?void 0:[]}return this[a?"find":"filter"](function(d){for(var c in b){if(b[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(O.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(O.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},pluck:function(a){return O.invoke(this.models,"get",a)},fetch:function(c){c=c?O.clone(c):{};if(c.parse===void 0){c.parse=true}var a=c.success;var b=this;c.success=function(e){var d=c.reset?"reset":"set";b[d](e,c);if(a){a(b,e,c)}b.trigger("sync",b,e,c)};S(this,c);return this.sync("read",this,c)},create:function(c,d){d=d?O.clone(d):{};if(!(c=this._prepareModel(c,d))){return false}if(!d.wait){this.add(c,d)}var a=this;var b=d.success;d.success=function(f,e){if(d.wait){a.add(f,d)}if(b){b(f,e,d)}};c.save(null,d);return c},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,b){if(a instanceof V){return a}b=b?O.clone(b):{};b.collection=this;var c=new this.model(a,b);if(!c.validationError){return c}this.trigger("invalid",this,c.validationError,b);return false},_addReference:function(a,b){this._byId[a.cid]=a;if(a.id!=null){this._byId[a.id]=a}if(!a.collection){a.collection=this}a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,c,a,d){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(c,d)}if(c&&b==="change:"+c.idAttribute){delete this._byId[c.previous(c.idAttribute)];if(c.id!=null){this._byId[c.id]=c}}this.trigger.apply(this,arguments)}});var ab=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];O.each(ab,function(a){aA.prototype[a]=function(){var b=an.call(arguments);b.unshift(this.models);return O[a].apply(O,b)}});var aq=["groupBy","countBy","sortBy","indexBy"];O.each(aq,function(a){aA.prototype[a]=function(b,d){var c=O.isFunction(b)?b:function(e){return e.get(b)};return O[a](this.models,c,d)}});var T=aa.View=function(a){this.cid=O.uniqueId("view");a||(a={});O.extend(this,O.pick(a,ay));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var af=/^(\S+)\s*(.*)$/;var ay=["model","collection","el","id","attributes","className","tagName","events"];O.extend(T.prototype,Q,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(b,a){if(this.$el){this.undelegateEvents()}this.$el=b instanceof aa.$?b:aa.$(b);this.el=this.$el[0];if(a!==false){this.delegateEvents()}return this},delegateEvents:function(b){if(!(b||(b=O.result(this,"events")))){return this}this.undelegateEvents();for(var c in b){var a=b[c];if(!O.isFunction(a)){a=this[b[c]]}if(!a){continue}var d=c.match(af);var e=d[1],f=d[2];a=O.bind(a,this);e+=".delegateEvents"+this.cid;if(f===""){this.$el.on(e,a)}else{this.$el.on(e,f,a)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var b=O.extend({},O.result(this,"attributes"));if(this.id){b.id=O.result(this,"id")}if(this.className){b["class"]=O.result(this,"className")}var a=aa.$("<"+O.result(this,"tagName")+">").attr(b);this.setElement(a,false)}else{this.setElement(O.result(this,"el"),false)}}});aa.sync=function(a,f,g){var d=ar[a];O.defaults(g||(g={}),{emulateHTTP:aa.emulateHTTP,emulateJSON:aa.emulateJSON});var b={type:d,dataType:"json"};if(!g.url){b.url=O.result(f,"url")||aj()}if(g.data==null&&f&&(a==="create"||a==="update"||a==="patch")){b.contentType="application/json";b.data=JSON.stringify(g.attrs||f.toJSON(g))}if(g.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(g.emulateHTTP&&(d==="PUT"||d==="DELETE"||d==="PATCH")){b.type="POST";if(g.emulateJSON){b.data._method=d}var e=g.beforeSend;g.beforeSend=function(h){h.setRequestHeader("X-HTTP-Method-Override",d);if(e){return e.apply(this,arguments)}}}if(b.type!=="GET"&&!g.emulateJSON){b.processData=false}if(b.type==="PATCH"&&at){b.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var c=g.xhr=aa.ajax(O.extend(b,g));f.trigger("request",f,c,g);return c};var at=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var ar={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};aa.ajax=function(){return aa.$.ajax.apply(aa.$,arguments)};var al=aa.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var ak=/\((.*?)\)/g;var ai=/(\(\?)?:\w+/g;var az=/\*\w+/g;var av=/[\-{}\[\]+?.,\\\^$|#\s]/g;O.extend(al.prototype,Q,{initialize:function(){},route:function(c,b,a){if(!O.isRegExp(c)){c=this._routeToRegExp(c)}if(O.isFunction(b)){a=b;b=""}if(!a){a=this[b]}var d=this;aa.history.route(c,function(e){var f=d._extractParameters(c,e);d.execute(a,f);d.trigger.apply(d,["route:"+b].concat(f));d.trigger("route",b,f);aa.history.trigger("route",d,b,f)});return this},execute:function(a,b){if(a){a.apply(this,b)}},navigate:function(a,b){aa.history.navigate(a,b);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=O.result(this,"routes");var a,b=O.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(av,"\\$&").replace(ak,"(?:$1)?").replace(ai,function(b,c){return c?b:"([^/?]+)"}).replace(az,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(c,b){var a=c.exec(b).slice(1);return O.map(a,function(d,e){if(e===a.length-1){return d||null}return d?decodeURIComponent(d):null})}});var au=aa.History=function(){this.handlers=[];O.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var Z=/^[#\/]|\s+$/g;var ax=/^\/+|\/+$/g;var R=/msie [\w.]+/;var ao=/\/$/;var U=/#.*$/;au.started=false;O.extend(au.prototype,Q,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(a==null){if(this._hasPushState||!this._wantsHashChange||b){a=decodeURI(this.location.pathname+this.location.search);var c=this.root.replace(ao,"");if(!a.indexOf(c)){a=a.slice(c.length)}}else{a=this.getHash()}}return a.replace(Z,"")},start:function(d){if(au.started){throw new Error("Backbone.history has already been started")}au.started=true;this.options=O.extend({root:"/"},this.options,d);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var f=document.documentMode;var c=(R.exec(navigator.userAgent.toLowerCase())&&(!f||f<=7));this.root=("/"+this.root+"/").replace(ax,"/");if(c&&this._wantsHashChange){var a=aa.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=a.hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){aa.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!c){aa.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=e;var b=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else{if(this._hasPushState&&this.atRoot()&&b.hash){this.fragment=this.getHash().replace(Z,"");this.history.replaceState({},document.title,this.root+this.fragment)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){aa.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}au.started=false},route:function(b,a){this.handlers.unshift({route:b,callback:a})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()},loadUrl:function(a){a=this.fragment=this.getFragment(a);return O.any(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(a,b){if(!au.started){return false}if(!b||b===true){b={trigger:!!b}}var c=this.root+(a=this.getFragment(a||""));a=a.replace(U,"");if(this.fragment===a){return}this.fragment=a;if(a===""&&c!=="/"){c=c.slice(0,-1)}if(this._hasPushState){this.history[b.replace?"replaceState":"pushState"]({},document.title,c)}else{if(this._wantsHashChange){this._updateHash(this.location,a,b.replace);if(this.iframe&&(a!==this.getFragment(this.getHash(this.iframe)))){if(!b.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,a,b.replace)}}else{return this.location.assign(c)}}if(b.trigger){return this.loadUrl(a)}},_updateHash:function(d,b,a){if(a){var c=d.href.replace(/(javascript:|#).*$/,"");d.replace(c+"#"+b)}else{d.hash="#"+b}}});aa.history=new au;var ap=function(e,c){var d=this;var a;if(e&&O.has(e,"constructor")){a=e.constructor}else{a=function(){return d.apply(this,arguments)}}O.extend(a,d,c);var b=function(){this.constructor=a};b.prototype=d.prototype;a.prototype=new b;if(e){O.extend(a.prototype,e)}a.__super__=d.prototype;return a};V.extend=aA.extend=al.extend=T.extend=au.extend=ap;var aj=function(){throw new Error('A "url" property or function must be specified')};var S=function(a,b){var c=b.error;b.error=function(d){if(c){c(a,d,b)}a.trigger("error",a,d,b)}};return aa}));