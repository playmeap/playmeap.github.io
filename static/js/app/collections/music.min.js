define(["jquery","underscore","backbone","app/models/audio-item"],function(b,a,e,d){var c=e.Collection.extend({model:d,url:"audio.get",initialize:function(){this.collectionModel=new (e.Model.extend());this.collectionModel.bind("change",this.fetch,this);this.setElement(this.at(0))},searchByName:function(g){g=g.split(" ").join("").toLocaleLowerCase();if(!g){return false}var f=a.filter(this.models,function(j){var l=j.get("title");var h=j.get("artist");var k=l+h;var i=k.split(" ").join("").toLocaleLowerCase().indexOf(g);if(i>=0){return true}});return f},fetch:function(){var f=this;var g=this.collectionModel.toJSON();VK.Api.call(this.url,g,function(i){if(i&&i.response){var h=i.response.slice(1,i.response.length);h=a.map(h,function(k){var j=f.findWhere({aid:k.aid,owner_id:k.owner_id});if(!j){return k}g=a.extend(k,j.toJSON());return g},this);f.reset(h)}else{alert(i.error.error_msg);f.reset([])}})},getElement:function(){return this.currentElement},setElement:function(f){this.currentElement=f},next:function(){this.setElement(this.at(this.indexOf(this.getElement())+1));return this},prev:function(){this.setElement(this.at(this.indexOf(this.getElement())-1));return this}});return c});