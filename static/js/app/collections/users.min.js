define(["jquery","underscore","backbone"],function(b,a,d){var c=d.Collection.extend({url:"friends.get",initialize:function(){this.collectionModel=new (d.Model.extend());this.collectionModel.set({fields:["nickname","sex","bdate","photo_50","online","status","can_see_audio","online"]},{silent:true});this.collectionModel.bind("change",this.fetch,this);this.setElement(this.at(0))},searchByName:function(f){f=f.split(" ").join("").toLocaleLowerCase();if(!f){return false}var e=a.filter(this.models,function(j){var k=j.get("first_name");var h=j.get("last_name");var g=j.get("user_id");var l=k+h+g;l=l.split(" ").join("").toLocaleLowerCase();var i=l.indexOf(f);if(i>=0){return true}});return e},fetch:function(){var e=this;var f=this.collectionModel.toJSON();VK.Api.call(this.url,f,function(h){if(h&&h.response){var g=a.filter(h.response,function(i){return i.can_see_audio},e);e.reset(g)}else{alert(h.error.error_msg);e.reset([])}})},getElement:function(){return this.currentElement},setElement:function(e){this.currentElement=e},next:function(){this.setElement(this.at(this.indexOf(this.getElement())+1));return this},prev:function(){this.setElement(this.at(this.indexOf(this.getElement())-1));return this}});return c});