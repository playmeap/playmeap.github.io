define(["jquery","underscore","backbone","app/router","config","app/helpers/index"],function(e,c,g,f,b,a){var d={views:{},models:{},collections:{}};d.config=c.extend(b,{});d.attributes={};d._attributes={};c.extend(d.attributes,d.config.defaultOptions);c.each(a,function(i,h){i.prototype.app=this;this[h]=new i()},d);d.log=function(h){if(d.attributes.debug){console.log(h)}};d.fn.initialize=function(){d.log("[App.fn.initialize]")};d.fn.start=function(){d.log("App.fn.start");d.log({data:d});g.Router.prototype.app=d;g.View.prototype.app=d;g.Model.prototype.app=d;g.Collection.prototype.app=d;if(document.readyState==="complete"){d.router=new f();d.fn.initialize();g.history.start({pushState:false})}else{document.addEventListener("DOMContentLoaded",function(){window.removeEventListener("load",arguments.callee,false);document.removeEventListener("DOMContentLoaded",arguments.callee,false);d.router=new f();d.fn.initialize();g.history.start({pushState:false})});window.addEventListener("load",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);window.removeEventListener("load",arguments.callee,false);d.router=new f();d.fn.initialize();g.history.start({pushState:false})},false)}};d.vk.init({apiId:d.attributes.apiIds.active});d.vk.Auth.getLoginStatus(function(h){if(h.session){d.log("app.js VK.Auth.getLoginStatus : login = true");d.fn.set("login",true);d.fn.set(h.session);d.fn.start()}else{d.log("app.js VK.Auth.getLoginStatus : login = false");d.fn.start();d.log({data:{msg:"app js init",app:d}})}});return d});