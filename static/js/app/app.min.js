define(["jquery","underscore","backbone","app/router","config"],function(e,c,g,f,b){var a=g.View.prototype.remove;g.View.prototype.remove=function(){if(this.nodes){for(var h in this.nodes){if(h.indexOf("$")>=0){this.nodes[h].remove()}}}if(this.children){for(var i in this.children){if(this.children[i].remove){this.children[i].remove()}}}return a.call(this,arguments)};var d={views:{},models:{},collections:{}};d.config=c.extend(b,{});d.options=c.extend(d.config.defaultOptions,{});d.attributes={};d._attributes={};d.fn={};d.fn.getScope=function(){return d.options.scope.intValues.reduce(function(h,i){return parseInt(h)+parseInt(i)})};d.log=function(h){if(d.options.debug){if(typeof h==="string"){console.log(">> "+h)}if(h.data){console.log(h.data);console.log("")}}};d.fn.initialize=function(){d.log("[App.fn.initialize]")};d.fn.start=function(){d.log("App.fn.start");g.Router.prototype.app=d;g.View.prototype.app=d;g.Model.prototype.app=d;g.Collection.prototype.app=d;if(document.readyState==="complete"){d.router=new f();d.fn.initialize();g.history.start({pushState:false})}else{document.addEventListener("DOMContentLoaded",function(){window.removeEventListener("load",arguments.callee,false);document.removeEventListener("DOMContentLoaded",arguments.callee,false);d.router=new f();d.fn.initialize();g.history.start({pushState:false})});window.addEventListener("load",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);window.removeEventListener("load",arguments.callee,false);d.router=new f();d.fn.initialize();g.history.start({pushState:false})},false)}};if(document.location.href.indexOf("local")>=0){d.options.debug=true}d.options.apiIds.active=(d.options.debug)?d.options.apiIds.test:d.options.apiIds.prod;VK.init({apiId:d.options.apiIds.active});VK.Auth.getLoginStatus(function(h){if(h.session){d.log("app.js VK.Auth.getLoginStatus : login = true");d.attributes.login=true;c.extend(d.attributes,d.options.defaultOptions,h.session);d.fn.start();sessionStorage.setItem("respsession",JSON.stringify(h.session))}else{d.log("app.js VK.Auth.getLoginStatus : login = false");c.extend(d.attributes,d.options.defaultOptions);d.fn.start()}});return d});