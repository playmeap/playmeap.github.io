define(["jquery","underscore","backbone","text!templates/audios/list-item-favorite.html"],function(d,b,e,a){var c=e.View.extend({tagName:"li",className:"col-sm-12 audioListItem disable",events:{"click .favorite-remove":"removeToFavorite","click .play":"playItem","click .pause":"pauseItem","click .progress":"rewind","click .download":"downloadItem"},initialize:function(){this.model.collection.bind("remove",function(f){if(f.cid==this.model.cid){this.remove()}},this);this.play=function(){this.el.classList.add("active");this.el.querySelector(".playcontrol").classList.add("glyphicon-pause","pause");this.el.querySelector(".playcontrol").classList.remove("glyphicon-play","play")}.bind(this);this.stop=function(){this.el.classList.remove("active");this.el.querySelector(".playcontrol").classList.remove("glyphicon-pause","pause");this.el.querySelector(".playcontrol").classList.add("glyphicon-play","play")}.bind(this);this.pause=function(){this.el.querySelector(".playcontrol").classList.remove("glyphicon-pause","pause");this.el.querySelector(".playcontrol").classList.add("glyphicon-play","play")}.bind(this);this.$el.on("play",this.play);this.$el.on("stop",this.stop);this.$el.on("pause",this.pause)},downloadItem:function(){},playItem:function(){this.app.views.playerController.play(this.model.get("aid"))},pauseItem:function(){this.app.views.playerController.pause()},rewind:function(i){var f=i.offsetX==undefined?i.layerX:i.offsetX;var g=this.$nodeProgress.width();var h=f/g*100;this.app.views.playerController.rewind(h)},removeToFavorite:function(){var f=this;var g={};g.mid=this.app.attributes.mid;g.album_id=0;g.audio_ids=[this.model.get("aid")];VK.Api.call("audio.moveToAlbum",g,function(h){if(h&&h.response){f.app.collections.audioFavorites.add(f.model);f.model.collection.remove(f.model)}})},render:function(){var g=this.model.toJSON();g.favorite=(this.app.collections.audioFavorites.where({aid:g.aid}).length>=1)?1:0;this.el.innerHTML=b.template(a)(g);this.$el.addClass("audio_item audio_"+g.aid);this.nodeProgress=this.el.querySelector(".progress");this.$nodeProgress=d(this.nodeProgress);var f=this.app.models.index.get("active_composition");if(f&&f===g.aid){this.play()}return this}});return c});