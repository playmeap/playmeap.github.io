define(["jquery","underscore","backbone","text!templates/audios/list-item.html"],function(d,b,e,a){var c=e.View.extend({tagName:"li",className:"col-sm-12 audioListItem disable",events:{"click .favorite":"addToFavorite","click .play":"playItem","click .pause":"pauseItem","click .progress":"rewind"},initialize:function(){var h=function(){this.el.querySelector(".playcontrol").classList.add("glyphicon-pause","pause");this.el.querySelector(".playcontrol").classList.remove("glyphicon-play","play")}.bind(this);var f=function(){this.el.querySelector(".playcontrol").classList.remove("glyphicon-pause","pause");this.el.querySelector(".playcontrol").classList.add("glyphicon-play","play")}.bind(this);var g=function(){this.el.querySelector(".playcontrol").classList.remove("glyphicon-pause","pause");this.el.querySelector(".playcontrol").classList.add("glyphicon-play","play")}.bind(this);this.$el.on("play",h);this.$el.on("stop",f);this.$el.on("pause",g)},playItem:function(){this.app.views.playerController.play(this.model.get("aid"))},pauseItem:function(){this.app.views.playerController.pause(this.model.get("aid"))},rewind:function(i){var f=i.offsetX==undefined?i.layerX:i.offsetX;var g=this.$nodeProgress.width();var h=f/g*100;this.app.views.playerController.rewind(h)},addToFavorite:function(){var g=this;var h={};h.album_id=this.app.models.index.get("play_album");h.audio_ids=[this.model.get("aid")];var f={};f.owner_id=this.app.attributes.mid;if(this.model.get("owner_id")!==this.app.attributes.mid){VK.Api.call("audio.get",f,function(i){if(i&&i.response){var j=b.where(i.response,{artist:g.model.get("artist"),duration:g.model.get("duration"),title:g.model.get("title")});if(j.length>=1){b.each(j,function(l){VK.Api.call("audio.delete",{audio_id:l.aid,owner_id:g.app.attributes.mid},function(m){})})}var k={owner_id:g.model.get("owner_id"),audio_id:g.model.get("aid")};VK.Api.call("audio.add",k,function(l){if(l&&l.response){h.audio_ids=[l.response];VK.Api.call("audio.moveToAlbum",h,function(m){if(m&&m.response){g.app.collections.audioFavorites.add(g.model)}})}})}})}else{VK.Api.call("audio.moveToAlbum",h,function(i){if(i&&i.response){g.app.collections.audioFavorites.add(g.model)}})}},render:function(){var f=this.model.toJSON();this.el.innerHTML=b.template(a)(f);this.$el.addClass("audio_item audio_"+f.aid);this.nodeProgress=this.el.querySelector(".progress");this.$nodeProgress=d(this.nodeProgress);return this}});return c});