define(["underscore","backbone"],function(b,c){var a=c.Collection.extend({options:{offset:0,},initialize:function(d){if(!d||!d.owner_id){alert("error init collection");this.app.log({msg:"error init collection",data:d});return false}this.options=b.extend(this.options,d);this.bind("reset",function(){this.setElement(this.at(0))},this);this.loadData()},getElement:function(){return this.currentElement},setElement:function(d){this.currentElement=d},next:function(){this.setElement(this.at(this.indexOf(this.getElement())+1));return this},prev:function(){this.setElement(this.at(this.indexOf(this.getElement())-1));return this},loadData:function(i){var g=this;var h=this.options;h.offset=(h.page>1)?h.count/(h.page-1):0;delete h.page;if(h.album_id){var f=function(){h.album_id=g.app.models.index.get("play_album");VK.Api.call("audio.get",h,function(k){if(k&&k.response){var j=k.response.slice(1,k.response.length);g.reset(j);if(i){i(true)}}else{alert(k.error.error_msg);g.reset([]);if(i){i(false)}}})};var e=function(k){var j=b.findWhere(k,{title:"playMe"});if(!j){VK.Api.call("audio.addAlbum",{title:"playMe"},function(l){if(l&&l.response){g.app.models.index.set({play_album:l.response.album_id});f.apply(g)}else{alert("error create playme album")}})}else{g.app.models.index.set({play_album:j.album_id});f.apply(g)}};var d=g.app.models.index.get("play_album");if(!d&&this.app.attributes.logined){VK.Api.call("audio.getAlbums",h,function(j){if(j&&j.response){e(j.response.slice(1,j.response.length))}else{}})}else{if(this.app.attributes.logined){f.apply(g)}else{g.reset([])}}}else{delete h.album_id;VK.Api.call("audio.get",h,function(k){if(k&&k.response){var j=k.response.slice(1,k.response.length);g.reset(j);if(i){i(true)}}else{alert(k.error.error_msg);g.reset([]);if(i){i(false)}}})}}});return a});